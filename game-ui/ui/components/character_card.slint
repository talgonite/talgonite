import { Theme } from "../theme.slint";
import { SavedLoginItem } from "../types.slint";

export component CharacterCard inherits Rectangle {
    in property <SavedLoginItem> character;
    in property <bool> disabled: false;
    callback login();
    callback remove();
    width: 140px;
    height: 170px;
    background: touch.has-hover && !delete-touch.has-hover && !disabled ? #FFFFFF08 : transparent;
    border-radius: Theme.radius-medium;
    border-width: 1px;
    border-color: touch.has-hover && !delete-touch.has-hover && !disabled ? Theme.border-overlay : Theme.border-subtle;
    touch := TouchArea {
        mouse-cursor: disabled ? default : pointer;
        clicked => {
            if (!disabled && !delete-touch.has-hover) {
                root.login();
            }
        }
    }

    VerticalLayout {
        padding: 12px;
        spacing: 10px;
        alignment: center;
        Rectangle {
            width: 80px;
            height: 80px;
            background: #00000040;
            border-radius: Theme.radius-small;
            border-width: 1px;
            border-color: Theme.border-subtle;
            Image {
                x: (parent.width - self.width) / 2;
                y: (parent.height - self.height) / 2;
                source: character.preview;
                width: parent.width;
                height: parent.height;
                image-fit: contain;
            }

            if (character.preview.width == 0): Text {
                x: 0;
                y: 0;
                width: 100%;
                height: 100%;
                text: "\u{1F464}";
                font-size: 36px;
                horizontal-alignment: center;
                vertical-alignment: center;
                color: Theme.foreground-subtle;
            }
        }

        Text {
            text: character.username;
            font-size: 14px;
            font-weight: 600;
            color: Theme.foreground;
            horizontal-alignment: center;
            overflow: elide;
        }
    }

    // Delete button - TouchArea always active so hover can be detected
    Rectangle {
        x: parent.width - self.width - 6px;
        y: 6px;
        width: 28px;
        height: 28px;
        delete-touch := TouchArea {
            mouse-cursor: touch.has-hover && !disabled ? pointer : default;
            clicked => {
                if (!disabled) {
                    root.remove();
                }
            }
        }

        // Visual only shown when card is hovered
        if !disabled: Rectangle {
            width: 100%;
            height: 100%;
            background: #00000080;
            border-radius: 4px;
            opacity: 0.0;
            Text {
                width: 100%;
                height: 100%;
                text: "\u{00D7}";
                font-size: 16px;
                font-weight: 700;
                color: delete-touch.has-hover ? #FFAAAA : Theme.foreground-muted;
                horizontal-alignment: center;
                vertical-alignment: center;
            }

            states [
                card-hovered when touch.has-hover: {
                    opacity: 1.0;
                }
                delete-hovered when delete-touch.has-hover: {
                    background: #FF404060;
                    opacity: 1.0;
                }
            ]
        }
    }
}

export component AddAccountCard inherits Rectangle {
    in property <bool> disabled: false;
    callback clicked();
    width: 140px;
    height: 170px;
    background: touch.has-hover && !disabled ? #FFFFFF08 : transparent;
    border-radius: Theme.radius-medium;
    border-width: 1px;
    border-color: touch.has-hover && !disabled ? Theme.border-overlay : Theme.border-subtle;
    touch := TouchArea {
        mouse-cursor: disabled ? default : pointer;
        clicked => {
            if (!disabled) {
                root.clicked();
            }
        }
    }

    VerticalLayout {
        alignment: center;
        spacing: 8px;
        Text {
            text: "+";
            font-size: 32px;
            font-weight: 300;
            color: touch.has-hover ? Theme.foreground : Theme.foreground-subtle;
            horizontal-alignment: center;
        }

        Text {
            text: "New Login";
            font-size: 13px;
            color: touch.has-hover ? Theme.foreground : Theme.foreground-subtle;
            horizontal-alignment: center;
        }
    }
}
