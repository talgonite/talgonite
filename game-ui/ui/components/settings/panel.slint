import { SettingsState } from "../../settings_state.slint";
import { Theme } from "../../theme.slint";
import { ScrollView, VerticalBox, HorizontalBox } from "std-widgets.slint";
import { MenuButton } from "widgets.slint";
import { GraphicsTab } from "graphics.slint";
import { ControlsTab } from "controls.slint";
import { BasePanel } from "../base_panel.slint";

export component SettingsPanel inherits BasePanel {
    in-out property <int> active-tab: 0;
    title: "Main Menu";
    width: 520px;
    height: 440px;
    close => {
        SettingsState.show-settings = false;
    }

    // Use a Rectangle to group the TouchArea and VerticalBox so they stack
    // instead of being laid out vertically by BasePanel's internal layout.
    Rectangle {
        TouchArea {
            width: 100%;
            height: 100%;
            scroll-event(event) => {
                accept
            }
        }

        VerticalBox {
            padding-left: 12px;
            padding-right: 12px;
            padding-top: 2px;
            padding-bottom: 12px;
            spacing: 8px;

            HorizontalBox {
                spacing: 12px;

                VerticalBox {
                    width: 140px;
                    spacing: 6px;

                    MenuButton {
                        label: "Resume";
                        clicked => {
                            SettingsState.show-settings = false;
                        }
                    }

                    MenuButton {
                        label: "Graphics";
                        selected: active-tab == 0;
                        clicked => {
                            active-tab = 0;
                        }
                    }

                    MenuButton {
                        label: "Controls";
                        selected: active-tab == 1;
                        clicked => {
                            active-tab = 1;
                        }
                    }

                    Rectangle {
                        height: 6px;
                    }

                    MenuButton {
                        label: "Log Out";
                        clicked => {
                            SettingsState.logout-requested();
                            SettingsState.show-settings = false;
                        }
                    }

                    MenuButton {
                        label: "Exit Game";
                        danger: true;
                        clicked => {
                            SettingsState.exit-requested();
                            SettingsState.show-settings = false;
                        }
                    }
                }

                Rectangle {
                    width: 1px;
                    background: Theme.border-subtle;
                }

                Rectangle {
                    vertical-stretch: 1;
                    horizontal-stretch: 1;
                    // Tab Content
                    if active-tab == 0: ScrollView {
                        viewport-width: self.visible-width;
                        GraphicsTab {
                            alignment: start;
                        }
                    }

                    if active-tab == 1: ScrollView {
                        viewport-width: self.visible-width;
                        ControlsTab {
                            alignment: start;
                        }
                    }
                }
            }
        }
    }
}
