import { Theme } from "../../game-ui/ui/theme.slint";
import { GameState, DragDropState, PopupState, NpcDialogState } from "../../game-ui/ui/game_state.slint";
import { SocialStatusState, SocialStatusEntry } from "../../game-ui/ui/social_status_state.slint";
import { SettingsState } from "../../game-ui/ui/settings_state.slint";

import { SocialStatusPanel, SocialStatusIndicator, SocialStatusDropdown, SocialStatusDropdownOverlay } from "../../game-ui/ui/components/social_status_panel.slint";
import { ProfilePanel } from "../../game-ui/ui/components/profile_panel.slint";
import { WorldListPanel } from "../../game-ui/ui/components/world_list.slint";
import { InventoryPanel } from "../../game-ui/ui/components/inventory_panel.slint";
import { ActionsPanel } from "../../game-ui/ui/components/actions_panel.slint";
import { HotBar } from "../../game-ui/ui/components/hot_bar.slint";
import { PlayerHUD } from "../../game-ui/ui/components/player_hud.slint";
import { ChatLog } from "../../game-ui/ui/components/chat_log.slint";
import { GameSidebar } from "../../game-ui/ui/components/game_sidebar.slint";
import { ActionBarMessages } from "../../game-ui/ui/components/action_bar_messages.slint";
import { PopupPanel } from "../../game-ui/ui/components/popup_panel.slint";
import { NpcDialog } from "../../game-ui/ui/components/menu_dialog.slint";
import { WorldMap } from "../../game-ui/ui/components/world_map.slint";
import { WorldLabels } from "../../game-ui/ui/components/world_labels.slint";
import { SettingsPanel } from "../../game-ui/ui/components/settings/panel.slint";
import { GameMenuPanel } from "../../game-ui/ui/components/settings/game_menu.slint";
import { LoginScene } from "../../game-ui/ui/components/login_scene.slint";

export { 
    Theme, GameState, DragDropState, PopupState, NpcDialogState,
    SocialStatusState, SocialStatusEntry, SettingsState 
}

component NavItem inherits Rectangle {
    in property <string> text;
    in property <bool> active;
    callback clicked();
    
    height: 32px;
    background: active ? #3a3a5e : touch.has-hover ? #2a2a3e : transparent;
    border-radius: 4px;
    
    HorizontalLayout {
        padding-left: 12px;
        Text {
            text: root.text;
            color: active ? #fff : #ccc;
            font-size: 13px;
            vertical-alignment: center;
        }
    }
    
    touch := TouchArea {
        clicked => { root.clicked(); }
    }
}

export component ViewerWindow inherits Window {
    title: "Talgonite UI Viewer";
    width: 1400px;
    height: 900px;
    background: #0d0d1a;
    
    in-out property <string> current-view: "social-status";
    
    HorizontalLayout {
        // Sidebar Navigation
        Rectangle {
            width: 220px;
            background: #161628;
            Rectangle {
                x: parent.width - 1px;
                width: 1px;
                height: 100%;
                background: #333;
            }
            
            VerticalLayout {
                padding: 16px;
                spacing: 4px;
                
                Text {
                    text: "UI Components";
                    color: Theme.accent;
                    font-size: 18px;
                    font-weight: 700;
                }
                Rectangle { height: 12px; }
                
                NavItem { text: "Social Status"; active: current-view == "social-status"; clicked => { current-view = "social-status"; } }
                NavItem { text: "Profile Panel"; active: current-view == "profile"; clicked => { current-view = "profile"; } }
                NavItem { text: "Inventory Panel"; active: current-view == "inventory"; clicked => { current-view = "inventory"; } }
                NavItem { text: "Actions Panel"; active: current-view == "actions"; clicked => { current-view = "actions"; } }
                NavItem { text: "World List"; active: current-view == "world-list"; clicked => { current-view = "world-list"; } }
                NavItem { text: "Player HUD"; active: current-view == "hud"; clicked => { current-view = "hud"; } }
                NavItem { text: "HotBar"; active: current-view == "hotbar"; clicked => { current-view = "hotbar"; } }
                NavItem { text: "Chat Log"; active: current-view == "chat"; clicked => { current-view = "chat"; } }
                NavItem { text: "Game Sidebar"; active: current-view == "sidebar"; clicked => { current-view = "sidebar"; } }
                NavItem { text: "Settings Panel"; active: current-view == "settings"; clicked => { current-view = "settings"; } }
                NavItem { text: "NPC Dialog"; active: current-view == "npc-dialog"; clicked => { current-view = "npc-dialog"; } }
                NavItem { text: "World Map"; active: current-view == "world-map"; clicked => { current-view = "world-map"; } }
                NavItem { text: "Login Scene"; active: current-view == "login"; clicked => { current-view = "login"; } }
                
                Rectangle { vertical-stretch: 1.0; } // Spacer
            }
        }
        
        // Main Content Area
        Rectangle {
            clip: true;
            background: #0d0d1a;
            
            // Background grid for visual reference
            for i in 20: Rectangle {
                x: i * 100px;
                width: 1px;
                height: 100%;
                background: #ffffff05;
            }
            for i in 20: Rectangle {
                y: i * 100px;
                width: 100%;
                height: 1px;
                background: #ffffff05;
            }

            // Component Views
            if (current-view == "social-status"): VerticalLayout {
                padding: 40px;
                spacing: 20px;
                Text { text: "Social Status Components"; font-size: 24px; color: #fff; }
                HorizontalLayout {
                    spacing: 20px;
                    Rectangle { 
                        width: 160px; height: 60px; background: #222; 
                        SocialStatusIndicator { 
                            x: (parent.width - self.width) / 2;
                            y: (parent.height - self.height) / 2;
                            interactive: true; 
                        } 
                    }
                    Rectangle { 
                        width: 160px; height: 60px; background: #222; 
                        SocialStatusIndicator { 
                            x: (parent.width - self.width) / 2;
                            y: (parent.height - self.height) / 2;
                            interactive: false; 
                            status-id: 2;
                        } 
                    }
                }
            }

            if (current-view == "profile"): VerticalLayout {
                padding: 40px;
                ProfilePanel { 
                    width: 520px;
                    height: 480px;
                }
            }

            if (current-view == "inventory"): VerticalLayout {
                padding: 40px;
                InventoryPanel { }
            }

            if (current-view == "actions"): VerticalLayout {
                padding: 40px;
                ActionsPanel { }
            }

            if (current-view == "world-list"): VerticalLayout {
                padding: 40px;
                WorldListPanel { }
            }

            if (current-view == "hud"): VerticalLayout {
                padding: 40px;
                PlayerHUD { }
            }

            if (current-view == "hotbar"): VerticalLayout {
                padding: 40px;
                alignment: end;
                HotBar { }
            }

            if (current-view == "chat"): VerticalLayout {
                padding: 40px;
                alignment: end;
                ChatLog { 
                    width: 400px;
                    height: 200px;
                }
            }

            if (current-view == "sidebar"): VerticalLayout {
                padding: 40px;
                alignment: start;
                HorizontalLayout {
                    alignment: end;
                    GameSidebar { }
                }
            }

            if (current-view == "settings"): VerticalLayout {
                padding: 40px;
                SettingsPanel { }
            }

            if (current-view == "npc-dialog"): NpcDialog { 
                width: 100%;
                height: 100%;
            }

            if (current-view == "world-map"): WorldMap { 
                width: 100%;
                height: 100%;
            }

            if (current-view == "login"): LoginScene { 
                width: 100%;
                height: 100%;
            }
            
            // Overlays that should always be present but hidden
            SocialStatusDropdownOverlay { }
            SocialStatusDropdown {
                anchor-x: 100px;
                anchor-y: 100px;
                visible: SocialStatusState.dropdown-open && current-view == "social-status";
            }
            
            PopupPanel {
                screen-width: parent.width;
                screen-height: parent.height;
            }
        }
    }
}
